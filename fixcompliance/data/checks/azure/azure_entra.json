{
    "provider": "azure",
    "service": "entra",
    "checks": [
        {
            "name": "security_defaults_enabled",
            "title": "Ensure Security Defaults is enabled on Microsoft Entra ID",
            "result_kinds": [ ],
            "categories": [ "security", "compliance" ],
            "risk": "Without Security Defaults enabled, organizations lack a basic level of security protection against common attacks, potentially exposing them to various security risks.",
            "severity": "high",
            "detect": {
                "manual": "1. From Azure Home select the Portal Menu.\n2. Browse to Microsoft Entra ID > Properties.\n3. Select Manage security defaults.\n4. Verify the Enable security defaults toggle is Enabled."
            },
            "remediation": {
                "text": "To enable security defaults:\n1. From Azure Home, select the Portal Menu.\n2. Browse to Microsoft Entra ID > Properties.\n3. Select Manage security defaults.\n4. Set the Enable security defaults toggle to Enabled.\n5. Select Save.",
                "url": "https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-identity-management#im-2-protect-identity-and-authentication-systems",
                "complexity": "low"
            },
            "url": "https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/concept-fundamentals-security-defaults",
            "localizations": {
                "de": {
                    "title": "Stellen Sie sicher, dass Sicherheitsstandards in Microsoft Entra ID aktiviert sind",
                    "risk": "Ohne aktivierte Sicherheitsstandards fehlt Organisationen ein grundlegender Schutz gegen häufige Angriffe, was sie potenziell verschiedenen Sicherheitsrisiken aussetzt.",
                    "remediation": "Um Sicherheitsstandards zu aktivieren: 1. Wählen Sie im Azure-Startbildschirm das Portalmenü aus. 2. Navigieren Sie zu Microsoft Entra ID > Eigenschaften. 3. Wählen Sie Sicherheitsstandards verwalten. 4. Setzen Sie den Schalter Sicherheitsstandards aktivieren auf Aktiviert. 5. Wählen Sie Speichern."
                }
            }
        },
        {
            "name": "mfa_status_enabled_privileged_users",
            "title": "Ensure that 'Multi-Factor Auth Status' is 'Enabled' for all Privileged Users",
            "result_kinds": [],
            "categories": ["security", "compliance"],
            "risk": "Without multi-factor authentication enabled for privileged users, organizations are at a higher risk of security breaches as attackers can more easily compromise accounts with higher access levels.",
            "severity": "high",
            "detect": {
                "manual": "From Azure Portal:\n1. From Azure Home select the Portal Menu.\n2. Select the Microsoft Entra ID blade.\n3. Select Users.\n4. Take note of all users with the role Service Co-Administrators, Owners or Contributors.\n5. Click on the Per-User MFA button in the top row menu.\n6. Ensure that MULTI-FACTOR AUTH STATUS is Enabled for all noted users.\n\nFrom REST API:\nFor Every Subscription, For Every Tenant:\nStep 1: Identify Users with Administrative Access\n1. List All Users Using Microsoft Graph API: GET https://graph.microsoft.com/v1.0/users\nCapture id and corresponding userPrincipalName ('$uid', '$userPrincipalName')\n2. List all Role Definitions Using Azure management API: https://management.azure.com/subscriptions/:subscriptionId/providers/Microsoft.Authorization/roleDefinitions?api-version=2017-05-01\nCapture Role Definition IDs/Name ('$name') and role names ('$properties/roleName') where 'properties/roleName' contains (Owner or *contributor or admin)\n3. List All Role Assignments (Mappings $A.uid to $B.name) Using Azure Management API: GET https://management.azure.com/subscriptions/:subscriptionId/providers/Microsoft.Authorization/roleassignments?api-version=2017-10-01-preview\nFind all administrative roles ($B.name) in 'Properties/roleDefinitionId' mapped with user ids ($A.id) in 'Properties/principalId' where 'Properties/principalType' == 'User'\n4. Now Match ($C.Properties/principalId) with $A.uid and get $A.userPrincipalName save this as D.userPrincipalName\nStep 2: Run MSOL PowerShell command: Get-MsolUser -All | where {$_.StrongAuthenticationMethods.Count -eq 0} | Select-Object -Property UserPrincipalName\nIf the output contains any of the $D.userPrincipalName, then this recommendation is non-compliant."
            },
            "remediation": {
                "text": "To enable multi-factor authentication:\nFrom Azure Portal:\n1. From Azure Home select the Portal Menu.\n2. Select Microsoft Entra ID blade.\n3. Select Users.\n4. Take note of all users with the role Service Co-Administrators, Owners or Contributors.\n5. Click on the Per-User MFA button in the top row menu.\n6. Check the box next to each noted user.\n7. Click Enable under quick steps in the right-hand panel.\n8. Click enable multi-factor auth.\n9. Click close.\n\nOther Options within Azure Portal:\nFollow Microsoft Azure documentation and enable multi-factor authentication in your environment: https://docs.microsoft.com/en-us/azure/active-directory/authentication/tutorial-enable-azure-mfa\n\nEnabling and configuring MFA with conditional access policy is a multi-step process. Here are some additional resources on the process within Entra ID to enable multi-factor authentication for users within your subscriptions with conditional access policy:\nhttps://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-conditional-access-policy-admin-mfa\nhttps://docs.microsoft.com/en-us/azure/active-directory/authentication/howto-mfa-getstarted#enable-multi-factor-authentication-with-conditional-access\nhttps://docs.microsoft.com/en-us/azure/active-directory/authentication/howto-mfa-mfasettings",
                "url": "https://docs.microsoft.com/en-us/azure/active-directory/authentication/tutorial-enable-azure-mfa",
                "complexity": "medium"
            },
            "url": "https://docs.microsoft.com/en-us/azure/multi-factor-authentication/multi-factor-authentication",
            "localizations": {
                "de": {
                    "title": "Stellen Sie sicher, dass der 'Multi-Faktor-Authentifizierungsstatus' für alle privilegierten Benutzer aktiviert ist",
                    "risk": "Ohne aktivierte Multi-Faktor-Authentifizierung für privilegierte Benutzer sind Organisationen einem höheren Risiko von Sicherheitsverletzungen ausgesetzt, da Angreifer leichter Konten mit höherem Zugriffslevel kompromittieren können.",
                    "remediation": "Um die Multi-Faktor-Authentifizierung zu aktivieren:\nVom Azure-Portal:\n1. Wählen Sie im Azure-Startbildschirm das Portalmenü aus.\n2. Navigieren Sie zur Microsoft Entra ID-Blade.\n3. Wählen Sie Benutzer aus.\n4. Notieren Sie alle Benutzer mit der Rolle Service Co-Administratoren, Eigentümer oder Mitwirkende.\n5. Klicken Sie auf die Schaltfläche Per-User-MFA im oberen Reihenmenü.\n6. Aktivieren Sie das Kontrollkästchen neben jedem notierten Benutzer.\n7. Klicken Sie im rechten Bereich unter Schnellschritte auf Aktivieren.\n8. Klicken Sie auf Multi-Faktor-Auth aktivieren.\n9. Klicken Sie auf Schließen.\n\nAndere Optionen im Azure-Portal:\nFolgen Sie der Microsoft Azure-Dokumentation und aktivieren Sie die Multi-Faktor-Authentifizierung in Ihrer Umgebung: https://docs.microsoft.com/en-us/azure/active-directory/authentication/tutorial-enable-azure-mfa"
                }
            }
        },
        {
            "name": "mfa_status_enabled_non_privileged_users",
            "title": "Ensure that 'Multi-Factor Auth Status' is 'Enabled' for all Non-Privileged Users",
            "result_kinds": [],
            "categories": ["security", "compliance"],
            "risk": "Without multi-factor authentication enabled for non-privileged users, organizations are at a higher risk of security breaches as attackers can more easily compromise accounts, leading to potential security risks.",
            "severity": "medium",
            "detect": {
                "manual": "From Azure Portal:\n1. From Azure Home select the Portal Menu.\n2. Select the Microsoft Entra ID blade.\n3. Select Users.\n4. Take note of all users with the role Service Co-Administrators, Owners or Contributors.\n5. Click on the Per-User MFA button in the top row menu.\n6. Ensure that MULTI-FACTOR AUTH STATUS is Enabled for all noted users.\n\nFrom REST API:\nFor Every Subscription, For Every Tenant:\nStep 1: Identify Users with non-administrative Access\n1. List All Users Using Microsoft Graph API: GET https://graph.microsoft.com/v1.0/users\nCapture id and corresponding userPrincipalName ($uid, $userPrincipalName)\n2. List all Role Definitions Using Azure management API: https://management.azure.com/subscriptions/<subscriptionId>/providers/Microsoft.Authorization/roleDefinitions?api-version=2017-05-01\nCapture Role Definition IDs/Name ($name) and role names ($properties/roleName) where 'properties/roleName' does NOT contain (Owner or *contributor or admin)\n3. List All Role Assignments (Mappings $A.uid to $B.name) Using Azure Management API: GET https://management.azure.com/subscriptions/<subscriptionId>/providers/Microsoft.Authorization/roleassignments?api-version=2017-10-01-preview\nFind all non-administrative roles ($B.name) in 'Properties/roleDefinitionId' mapped with user ids ($A.id) in 'Properties/principalId' where 'Properties/principalType' == 'User'\n4. Now Match ($C.Properties/principalId) with $A.uid and get $A.userPrincipalName save this as D.userPrincipalName\nStep 2: Run MSOL PowerShell command: Get-MsolUser -All | where {$_.StrongAuthenticationMethods.Count -eq 0} | Select-Object -Property UserPrincipalName\nIf the output contains any of the $D.userPrincipalName, then this recommendation is non-compliant."
            },
            "remediation": {
                "text": "To enable multi-factor authentication:\nFrom Azure Portal:\n1. From Azure Home select the Portal Menu.\n2. Select Microsoft Entra ID blade.\n3. Select Users.\n4. Take note of all users with the role Service Co-Administrators, Owners or Contributors.\n5. Click on the Per-User MFA button in the top row menu.\n6. Check the box next to each noted user.\n7. Click Enable under quick steps in the right-hand panel.\n8. Click enable multi-factor auth.\n9. Click close.\n\nOther Options within Azure Portal:\nFollow Microsoft Azure documentation and enable multi-factor authentication in your environment: https://docs.microsoft.com/en-us/azure/active-directory/authentication/tutorial-enable-azure-mfa\n\nEnabling and configuring MFA is a multi-step process. Here are some additional resources on the process within Microsoft Entra ID:\nhttps://learn.microsoft.com/en-us/entra/identity/conditional-access/howto-conditional-access-policy-admin-mfa\nhttps://learn.microsoft.com/en-us/entra/identity/authentication/howto-mfa-getstarted#enable-multi-factor-authentication-with-conditional-access\nhttps://learn.microsoft.com/en-us/entra/identity/authentication/howto-mfa-mfasettings",
                "url": "https://docs.microsoft.com/en-us/azure/active-directory/authentication/tutorial-enable-azure-mfa",
                "complexity": "medium"
            },
            "url": "https://docs.microsoft.com/en-us/azure/multi-factor-authentication/multi-factor-authentication",
            "localizations": {
                "de": {
                    "title": "Stellen Sie sicher, dass der 'Multi-Faktor-Authentifizierungsstatus' für alle nicht privilegierten Benutzer aktiviert ist",
                    "risk": "Ohne aktivierte Multi-Faktor-Authentifizierung für nicht privilegierte Benutzer sind Organisationen einem höheren Risiko von Sicherheitsverletzungen ausgesetzt, da Angreifer leichter Konten kompromittieren können, was zu potenziellen Sicherheitsrisiken führt.",
                    "remediation": "Um die Multi-Faktor-Authentifizierung zu aktivieren:\nVom Azure-Portal:\n1. Wählen Sie im Azure-Startbildschirm das Portalmenü aus.\n2. Navigieren Sie zur Microsoft Entra ID-Blade.\n3. Wählen Sie Benutzer aus.\n4. Notieren Sie alle Benutzer mit der Rolle Service Co-Administratoren, Eigentümer oder Mitwirkende.\n5. Klicken Sie auf die Schaltfläche Per-User-MFA im oberen Reihenmenü.\n6. Aktivieren Sie das Kontrollkästchen neben jedem notierten Benutzer.\n7. Klicken Sie im rechten Bereich unter Schnellschritte auf Aktivieren.\n8. Klicken Sie auf Multi-Faktor-Auth aktivieren.\n9. Klicken Sie auf Schließen.\n\nAndere Optionen im Azure-Portal:\nFolgen Sie der Microsoft Azure-Dokumentation und aktivieren Sie die Multi-Faktor-Authentifizierung in Ihrer Umgebung: https://docs.microsoft.com/en-us/azure/active-directory/authentication/tutorial-enable-azure-mfa"
                }
            }
        },
        {
            "name": "disable_mfa_remember_trusted_devices",
            "title": "Ensure that 'Allow users to remember multi-factor authentication on devices they trust' is Disabled",
            "result_kinds": [],
            "categories": ["security", "compliance"],
            "risk": "Allowing users to remember multi-factor authentication on devices they trust can reduce security by enabling users to bypass MFA for a set period. This can increase the risk if an account or device is compromised.",
            "severity": "medium",
            "detect": {
                "manual": "From Azure Portal:\n1. From Azure Home select the Portal Menu.\n2. Select Microsoft Entra ID.\n3. Select Users.\n4. Click the Per-user MFA button on the top bar.\n5. Click on service settings.\n6. Ensure that 'Allow users to remember multi-factor authentication on devices they trust' is not enabled."
            },
            "remediation": {
                "text": "To disable 'Allow users to remember multi-factor authentication on devices they trust':\nFrom Azure Portal:\n1. From Azure Home select the Portal Menu.\n2. Select Microsoft Entra ID.\n3. Select Users.\n4. Click the Per-user MFA button on the top bar.\n5. Click on service settings.\n6. Uncheck the box next to 'Allow users to remember multi-factor authentication on devices they trust'.",
                "url": "https://learn.microsoft.com/en-us/entra/identity/authentication/howto-mfa-mfasettings#remember-multi-factor-authentication-for-devices-that-users-trust",
                "complexity": "low"
            },
            "url": "https://learn.microsoft.com/en-us/entra/identity/authentication/howto-mfa-mfasettings#remember-multi-factor-authentication-for-devices-that-users-trust",
            "localizations": {
                "de": {
                    "title": "Stellen Sie sicher, dass 'Benutzern erlauben, die Multi-Faktor-Authentifizierung auf vertrauenswürdigen Geräten zu speichern' deaktiviert ist",
                    "risk": "Das Erlauben von Benutzern, die Multi-Faktor-Authentifizierung auf vertrauenswürdigen Geräten zu speichern, kann die Sicherheit verringern, da Benutzer die MFA für einen festgelegten Zeitraum umgehen können. Dies kann das Risiko erhöhen, wenn ein Konto oder Gerät kompromittiert wird.",
                    "remediation": "Um 'Benutzern erlauben, die Multi-Faktor-Authentifizierung auf vertrauenswürdigen Geräten zu speichern' zu deaktivieren:\nVom Azure-Portal:\n1. Wählen Sie im Azure-Startbildschirm das Portalmenü aus.\n2. Navigieren Sie zur Microsoft Entra ID.\n3. Wählen Sie Benutzer.\n4. Klicken Sie auf die Schaltfläche 'Per-user MFA' in der oberen Leiste.\n5. Klicken Sie auf Dienst-Einstellungen.\n6. Deaktivieren Sie das Kontrollkästchen neben 'Benutzern erlauben, die Multi-Faktor-Authentifizierung auf vertrauenswürdigen Geräten zu speichern'."
                }
            }
        },
        {
            "name": "trusted_named_locations_configured",
            "title": "Ensure that Named Locations are Configured and Marked as Trusted",
            "result_kinds": [],
            "categories": ["security", "compliance"],
            "risk": "Without configuring trusted named locations, organizations cannot effectively enforce Conditional Access policies based on trusted or untrusted IP addresses and ranges, potentially leading to less secure access control.",
            "severity": "medium",
            "detect": {
                "manual": "From Azure Portal:\n1. In the Azure Portal, navigate to Microsoft Entra ID Conditional Access.\n2. Click on Manage.\n3. Click on Named Locations.\n4. Ensure there are IP ranges location settings configured and marked as Trusted.\n\nFrom PowerShell:\nGet-AzureADMSNamedLocationPolicy\nIn the output from the above command, for each Named location group, make sure at least one entry contains the IsTrusted parameter with a value of True. Otherwise, if there is no output as a result of the above command or all of the entries contain the IsTrusted parameter with an empty value, a NULL value, or a value of False, the results are out of compliance with this check."
            },
            "remediation": {
                "text": "To configure trusted named locations:\nFrom Azure Portal:\n1. Navigate to the Microsoft Entra ID Conditional Access Blade.\n2. Click on the Named locations blade.\n3. Within the Named locations blade, click on IP ranges location.\n4. Enter a name for this location setting in the Name text box.\n5. Click on the + sign.\n6. Add an IP Address Range in CIDR notation inside the text box that appears.\n7. Click on the Add button.\n8. Repeat steps 5 through 7 for each IP Range that needs to be added.\n9. If the information entered are trusted ranges, select the Mark as trusted location check box.\n10. Once finished, click on Create.\n\nFrom PowerShell:\nCreate a new trusted IP-based Named location policy:\n[System.Collections.Generic.List`1[Microsoft.Open.MSGraph.Model.IpRange]]$ipRanges = @()\n$ipRanges.Add('<first IP range in CIDR notation>')\n$ipRanges.Add('<second IP range in CIDR notation>')\n$ipRanges.Add('<third IP range in CIDR notation>')\nNew-AzureADMSNamedLocationPolicy -OdataType '#microsoft.graph.ipNamedLocation' -DisplayName '<name of IP Named location policy>' -IsTrusted $true -IpRanges $ipRanges\n\nSet an existing IP-based Named location policy to trusted:\nSet-AzureADMSNamedLocationPolicy -PolicyId '<ID of the policy>' -OdataType '#microsoft.graph.ipNamedLocation' -IsTrusted $true.",
                "url": "https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/location-condition",
                "complexity": "medium"
            },
            "url": "https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/location-condition",
            "localizations": {
                "de": {
                    "title": "Stellen Sie sicher, dass benannte Standorte konfiguriert und als vertrauenswürdig markiert sind",
                    "risk": "Ohne die Konfiguration vertrauenswürdiger benannter Standorte können Organisationen keine wirksamen Zugriffsrichtlinien basierend auf vertrauenswürdigen oder nicht vertrauenswürdigen IP-Adressen und Bereichen durchsetzen, was zu weniger sicherer Zugriffskontrolle führen kann.",
                    "remediation": "Um vertrauenswürdige benannte Standorte zu konfigurieren:\nVom Azure-Portal:\n1. Navigieren Sie zur Microsoft Entra ID Conditional Access Blade.\n2. Klicken Sie auf die Named locations blade.\n3. Klicken Sie innerhalb der Named locations blade auf IP ranges location.\n4. Geben Sie einen Namen für diese Standortseinstellung im Name-Textfeld ein.\n5. Klicken Sie auf das + Zeichen.\n6. Fügen Sie eine IP-Adressbereich in CIDR-Notation in das erscheinende Textfeld ein.\n7. Klicken Sie auf die Schaltfläche Hinzufügen.\n8. Wiederholen Sie die Schritte 5 bis 7 für jeden IP-Bereich, der hinzugefügt werden muss.\n9. Wenn die eingegebenen Informationen vertrauenswürdige Bereiche sind, aktivieren Sie das Kontrollkästchen Mark as trusted location.\n10. Klicken Sie abschließend auf Create.\n\nVom PowerShell:\nErstellen Sie eine neue vertrauenswürdige IP-basierte Named location policy:\n[System.Collections.Generic.List`1[Microsoft.Open.MSGraph.Model.IpRange]]$ipRanges = @()\n$ipRanges.Add('<first IP range in CIDR notation>')\n$ipRanges.Add('<second IP range in CIDR notation>')\n$ipRanges.Add('<third IP range in CIDR notation>')\nNew-AzureADMSNamedLocationPolicy -OdataType '#microsoft.graph.ipNamedLocation' -DisplayName '<name of IP Named location policy>' -IsTrusted $true -IpRanges $ipRanges\n\nSetzen Sie eine bestehende IP-basierte Named location policy auf vertrauenswürdig:\nSet-AzureADMSNamedLocationPolicy -PolicyId '<ID der Richtlinie>' -OdataType '#microsoft.graph.ipNamedLocation' -IsTrusted $true."
                }
            }
        },
        {
            "name": "exclusionary_geographic_access_policy",
            "title": "Ensure that an Exclusionary Geographic Access Policy is Considered",
            "result_kinds": [],
            "categories": ["security", "compliance"],
            "risk": "Without an exclusionary geographic access policy, organizations cannot effectively control access based on geographic locations, potentially leading to unauthorized access from untrusted regions and increasing exposure to international threats.",
            "severity": "high",
            "detect": {
                "manual": "From Azure Portal:\n1. From Azure Home open the Portal menu in the top left, and select Microsoft Entra ID.\n2. Scroll down in the menu on the left, and select Security.\n3. Select Conditional Access.\n4. Select the policy you wish to audit, then:\n  - Under Assignments, review the Users and Groups for the personnel the policy will apply to.\n  - Under Assignments, review the Cloud apps or actions for the systems the policy will apply to.\n  - Under Conditions, review the Include locations for those that should be blocked.\n  - Under Conditions, review the Exclude locations for those that should be allowed (Note: locations set up in the previous recommendation for Trusted Location should be in the Exclude list).\n  - Under Access Controls > Grant, confirm that Block Access is selected.\n\nFrom PowerShell:\n$conditionalAccessPolicies = Get-AzureADMSConditionalAccessPolicy\nforeach($policy in $conditionalAccessPolicies) {\n  $policy | Select-Object @{N='Policy ID'; E={$policy.id}}, @{N='Included Locations'; E={$policy.Conditions.Locations.IncludeLocations}}, @{N='Excluded Locations'; E={$policy.Conditions.Locations.ExcludeLocations}}, @{N='BuiltIn GrantControls'; E={$policy.GrantControls.BuiltInControls}}\n}\nMake sure there is at least 1 row in the output of the above PowerShell command that contains Block under the BuiltIn GrantControls column and location IDs under the Included Locations and Excluded Locations columns. If not, a policy containing these options has not been created and is considered a finding."
            },
            "remediation": {
                "text": "To create an exclusionary geographic access policy:\n\nPart 1 of 2 - Create the policy and enable it in Report-only mode:\n1. From Azure Home open the portal menu in the top left, and select Microsoft Entra ID.\n2. Scroll down in the menu on the left, and select Security.\n3. Select Conditional Access.\n4. Click the + New policy button, then:\n  - Provide a name for the policy.\n  - Under Assignments, select Users or workload identities then:\n    - Under Include, select All users.\n    - Under Exclude, check Users and groups and only select emergency access accounts and service accounts (NOTE: Service accounts are excluded here because service accounts are non-interactive and cannot complete MFA).\n  - Under Assignments, select Cloud apps or actions then:\n    - Under Include, select All cloud apps.\n    - Leave Exclude blank unless you have a well-defined exception.\n  - Under Conditions, select Locations then:\n    - Select Include, then add entries for locations for those that should be blocked.\n    - Select Exclude, then add entries for those that should be allowed (IMPORTANT: Ensure that all Trusted Locations are in the Exclude list).\n  - Under Access Controls, select Grant and confirm that Block Access is selected.\n  - Set Enable policy to Report-only.\n  - Click Create.\nNOTE: The policy is not yet 'live,' since Report-only is being used to audit the effect of the policy.\n\nPart 2 of 2 - Confirm that the policy is not blocking access that should be granted, then toggle to On:\n1. With your policy now in report-only mode, return to the Microsoft Entra blade and click on Sign-in logs.\n2. Review the recent sign-in events - click an event then review the event details (specifically the Report-only tab) to ensure:\n  - The sign-in event you're reviewing occurred after turning on the policy in report-only mode.\n  - The policy name from step 5 above is listed in the Policy Name column.\n  - The Result column for the new policy shows that the policy was Not applied (indicating the location origin was not blocked).\n3. If the above conditions are present, navigate back to the policy name in Conditional Access and open it.\n4. Toggle the policy from Report-only to On.\n5. Click Save.\n\nFrom PowerShell:\nFirst, set up the conditions objects values before updating an existing conditional access policy or before creating a new one. You may need to use additional PowerShell cmdlets to retrieve specific IDs such as the Get-AzureADMSNamedLocationPolicy which outputs the Location IDs for use with conditional access policies.\n\n$conditions = New-Object -TypeName Microsoft.Open.MSGraph.Model.ConditionalAccessConditionSet\n$conditions.Applications = New-Object -TypeName Microsoft.Open.MSGraph.Model.ConditionalAccessApplicationCondition\n$conditions.Applications.IncludeApplications = <'All' | 'Office365' | 'app ID' | @('app ID 1', 'app ID 2', etc...)>\n$conditions.Applications.ExcludeApplications = <'Office365' | 'app ID' | @('app ID 1', 'app ID 2', etc...)>\n$conditions.Users = New-Object -TypeName Microsoft.Open.MSGraph.Model.ConditionalAccessUserCondition\n$conditions.Users.IncludeUsers = <'All' | 'None' | 'GuestsOrExternalUsers' | 'Specific User ID' | @('User ID 1', 'User ID 2', etc.)>\n$conditions.Users.ExcludeUsers = <'GuestsOrExternalUsers' | 'Specific User ID' | @('User ID 1', 'User ID 2', etc...)>\n$conditions.Users.IncludeGroups = <'group ID' | 'All' | @('Group ID 1', 'Group ID 2', etc...)>\n$conditions.Users.ExcludeGroups = <'group ID' | @('Group ID 1', 'Group ID 2', etc...)>\n$conditions.Users.IncludeRoles = <'Role ID' | 'All' | @('Role ID 1', 'Role ID 2', etc...)>\n$conditions.Users.ExcludeRoles = <'Role ID' | @('Role ID 1', 'Role ID 2', etc...)>\n$conditions.Locations = New-Object -TypeName Microsoft.Open.MSGraph.Model.ConditionalAccessLocationCondition\n$conditions.Locations.IncludeLocations = <'Location ID' | @('Location ID 1', 'Location ID 2', etc...)>\n$conditions.Locations.ExcludeLocations = <'AllTrusted' | 'Location ID' | @('Location ID 1', 'Location ID 2', etc...)>\n$controls = New-Object -TypeName Microsoft.Open.MSGraph.Model.ConditionalAccessGrantControls\n$controls._Operator = 'OR'\n$controls.BuiltInControls = 'block'\nNext, update the existing conditional access policy with the condition set options configured with the previous commands.\nSet-AzureADMSConditionalAccessPolicy -PolicyId <policy ID> -Conditions $conditions -GrantControls $controls\nTo create a new conditional access policy that complies with this best practice, run the following commands after creating the condition set above:\nNew-AzureADMSConditionalAccessPolicy -Name 'Policy Name' -State <enabled|disabled> -Conditions $conditions -GrantControls $controls.",
                "url": "https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-conditional-access-policy-location",
                "complexity": "high"
            },
            "url": "https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-conditional-access-policy-location",
            "localizations": {
                "de": {
                    "title": "Stellen Sie sicher, dass eine ausschließende geografische Zugriffsrichtlinie in Betracht gezogen wird",
                    "risk": "Ohne eine ausschließende geografische Zugriffsrichtlinie können Organisationen den Zugriff basierend auf geografischen Standorten nicht effektiv kontrollieren, was möglicherweise zu unbefugtem Zugriff aus unzuverlässigen Regionen und einer erhöhten Exposition gegenüber internationalen Bedrohungen führt.",
                    "remediation": "Um eine ausschließende geografische Zugriffsrichtlinie zu erstellen:\n\nTeil 1 von 2 - Erstellen Sie die Richtlinie und aktivieren Sie sie im Nur-Bericht-Modus:\n1. Öffnen Sie das Portalmenü oben links im Azure-Startbildschirm und wählen Sie Microsoft Entra ID.\n2. Scrollen Sie im Menü links nach unten und wählen Sie Sicherheit.\n3. Wählen Sie Bedingter Zugriff.\n4. Klicken Sie auf die Schaltfläche + Neue Richtlinie, und dann:\n  - Geben Sie einen Namen für die Richtlinie an.\n  - Wählen Sie unter Zuweisungen Benutzer oder Arbeitslast-Identitäten aus, dann:\n    - Unter Einschließen, wählen Sie Alle Benutzer.\n    - Unter Ausschließen, markieren Sie Benutzer und Gruppen und wählen Sie nur Notfallzugangskonten und Dienstkonten (HINWEIS: Dienstkonten sind hier ausgeschlossen, da sie nicht interaktiv sind und keine MFA durchführen können).\n  - Wählen Sie unter Zuweisungen Cloud-Apps oder Aktionen aus, dann:\n    - Unter Einschließen, wählen Sie Alle Cloud-Apps.\n    - Lassen Sie Ausschließen leer, es sei denn, Sie haben eine gut definierte Ausnahme.\n  - Wählen Sie unter Bedingungen Standorte aus, dann:\n    - Wählen Sie Einschließen, dann fügen Sie Einträge für Standorte hinzu, die blockiert werden sollen.\n    - Wählen Sie Ausschließen, dann fügen Sie Einträge für Standorte hinzu, die erlaubt sein sollen (WICHTIG: Stellen Sie sicher, dass alle vertrauenswürdigen Standorte in der Ausschlussliste enthalten sind).\n  - Wählen Sie unter Zugriffskontrollen Gewähren aus und bestätigen Sie, dass Blockzugriff ausgewählt ist.\n  - Setzen Sie die Richtlinie auf Nur-Bericht-Modus.\n  - Klicken Sie auf Erstellen.\nHINWEIS: Die Richtlinie ist noch nicht 'live', da der Nur-Bericht-Modus verwendet wird, um die Auswirkung der Richtlinie zu prüfen.\n\nTeil 2 von 2 - Bestätigen Sie, dass die Richtlinie keinen Zugriff blockiert, der gewährt werden sollte, und schalten Sie sie dann auf Ein:\n1. Mit Ihrer Richtlinie jetzt im Nur-Bericht-Modus, kehren Sie zur Microsoft Entra-Klinge zurück und klicken auf Anmeldeprotokolle.\n2. Überprüfen Sie die letzten Anmeldeereignisse - klicken Sie auf ein Ereignis und überprüfen Sie die Ereignisdetails (insbesondere die Registerkarte Nur-Bericht), um sicherzustellen:\n  - Das Anmeldeereignis, das Sie überprüfen, ist nach dem Einschalten der Richtlinie im Nur-Bericht-Modus aufgetreten.\n  - Der Richtlinienname aus Schritt 5 oben ist in der Spalte Richtlinienname aufgeführt.\n  - Die Ergebnisspalte für die neue Richtlinie zeigt, dass die Richtlinie nicht angewendet wurde (was darauf hinweist, dass der Standortursprung nicht blockiert wurde).\n3. Wenn die oben genannten Bedingungen erfüllt sind, navigieren Sie zurück zum Richtliniennamen im Bedingten Zugriff und öffnen Sie ihn.\n4. Schalten Sie die Richtlinie von Nur-Bericht auf Ein.\n5. Klicken Sie auf Speichern.\n\nVom PowerShell:\nRichten Sie zuerst die Bedingungen-Objektwerte ein, bevor Sie eine bestehende bedingte Zugriffsrichtlinie aktualisieren oder eine neue erstellen. Möglicherweise müssen Sie zusätzliche PowerShell-Cmdlets verwenden, um spezifische IDs wie das Get-AzureADMSNamedLocationPolicy abzurufen, das die Standort-IDs für die Verwendung mit bedingten Zugriffsrichtlinien ausgibt.\n\n$conditions = New-Object -TypeName Microsoft.Open.MSGraph.Model.ConditionalAccessConditionSet\n$conditions.Applications = New-Object -TypeName Microsoft.Open.MSGraph.Model.ConditionalAccessApplicationCondition\n$conditions.Applications.IncludeApplications = <'All' | 'Office365' | 'app ID' | @('app ID 1', 'app ID 2', etc...)>\n$conditions.Applications.ExcludeApplications = <'Office365' | 'app ID' | @('app ID 1', 'app ID 2', etc...)>\n$conditions.Users = New-Object -TypeName Microsoft.Open.MSGraph.Model.ConditionalAccessUserCondition\n$conditions.Users.IncludeUsers = <'All' | 'None' | 'GuestsOrExternalUsers' | 'Specific User ID' | @('User ID 1', 'User ID 2', etc.)>\n$conditions.Users.ExcludeUsers = <'GuestsOrExternalUsers' | 'Specific User ID' | @('User ID 1', 'User ID 2', etc...)>\n$conditions.Users.IncludeGroups = <'group ID' | 'All' | @('Group ID 1', 'Group ID 2', etc...)>\n$conditions.Users.ExcludeGroups = <'group ID' | @('Group ID 1', 'Group ID 2', etc...)>\n$conditions.Users.IncludeRoles = <'Role ID' | 'All' | @('Role ID 1', 'Role ID 2', etc...)>\n$conditions.Users.ExcludeRoles = <'Role ID' | @('Role ID 1', 'Role ID 2', etc...)>\n$conditions.Locations = New-Object -TypeName Microsoft.Open.MSGraph.Model.ConditionalAccessLocationCondition\n$conditions.Locations.IncludeLocations = <'Location ID' | @('Location ID 1', 'Location ID 2', etc...)>\n$conditions.Locations.ExcludeLocations = <'AllTrusted' | 'Location ID' | @('Location ID 1', 'Location ID 2', etc...)>\n$controls = New-Object -TypeName Microsoft.Open.MSGraph.Model.ConditionalAccessGrantControls\n$controls._Operator = 'OR'\n$controls.BuiltInControls = 'block'\nAktualisieren Sie dann die bestehende bedingte Zugriffsrichtlinie mit den zuvor konfigurierten Optionswerten für das Bedingungsset.\nSet-AzureADMSConditionalAccessPolicy -PolicyId <policy ID> -Conditions $conditions -GrantControls $controls\nUm eine neue bedingte Zugriffsrichtlinie zu erstellen, die diesen Best Practices entspricht, führen Sie die folgenden Befehle nach dem Erstellen des Bedingungssets oben aus:\nNew-AzureADMSConditionalAccessPolicy -Name 'Richtlinienname' -State <enabled|disabled> -Conditions $conditions -GrantControls $controls."
                }
            }
        },
        {
            "name": "mfa_policy_for_admin_groups",
            "title": "Ensure that a Multi-factor Authentication Policy Exists for Administrative Groups",
            "result_kinds": [],
            "categories": ["security", "compliance"],
            "risk": "Without a multi-factor authentication policy for administrative groups, there is a higher risk of unauthorized access to administrative accounts, which could lead to security breaches and unauthorized changes.",
            "severity": "high",
            "detect": {
                "manual": "From Azure Portal:\n1. From Azure Home open the Portal Menu in the top left, and select Microsoft Entra ID.\n2. Select Security.\n3. Select Conditional Access.\n4. Select the policy you wish to audit.\n5. View under Users and Groups the corresponding users and groups to whom the policy is applied. Be certain the emergency access account is not in the list.\n6. View under Exclude to determine which users and groups to whom the policy is not applied."
            },
            "remediation": {
                "text": "To create a multi-factor authentication policy for administrative groups:\nFrom Azure Portal:\n1. From Azure Home open the Portal Menu in top left, and select Microsoft Entra ID.\n2. Select Security.\n3. Select Conditional Access.\n4. Click + New policy.\n5. Enter a name for the policy.\n6. Select Users or workload identities.\n7. Check Users and groups.\n8. Select administrative groups this policy should apply to and click Select.\n9. Under Exclude, check Users and groups.\n10. Select users this policy should not apply to and click Select.\n11. Select Cloud apps or actions.\n12. Select All cloud apps.\n13. Select Grant.\n14. Under Grant access, check Require multifactor authentication and click Select.\n15. Set Enable policy to Report-only.\n16. Click Create.\nAfter testing the policy in report-only mode, update the Enable policy setting from Report-only to On.",
                "url": "https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-conditional-access-policy-admin-mfa",
                "complexity": "medium"
            },
            "url": "https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-conditional-access-policy-admin-mfa",
            "localizations": {
                "de": {
                    "title": "Stellen Sie sicher, dass eine Multi-Faktor-Authentifizierungsrichtlinie für administrative Gruppen vorhanden ist",
                    "risk": "Ohne eine Multi-Faktor-Authentifizierungsrichtlinie für administrative Gruppen besteht ein höheres Risiko eines unbefugten Zugriffs auf administrative Konten, was zu Sicherheitsverletzungen und unbefugten Änderungen führen könnte.",
                    "remediation": "Um eine Multi-Faktor-Authentifizierungsrichtlinie für administrative Gruppen zu erstellen:\nVom Azure-Portal:\n1. Öffnen Sie das Portalmenü oben links im Azure-Startbildschirm und wählen Sie Microsoft Entra ID.\n2. Wählen Sie Sicherheit.\n3. Wählen Sie Bedingter Zugriff.\n4. Klicken Sie auf + Neue Richtlinie.\n5. Geben Sie einen Namen für die Richtlinie ein.\n6. Wählen Sie Benutzer oder Arbeitslast-Identitäten.\n7. Markieren Sie Benutzer und Gruppen.\n8. Wählen Sie administrative Gruppen aus, auf die diese Richtlinie angewendet werden soll, und klicken Sie auf Auswählen.\n9. Unter Ausschließen, markieren Sie Benutzer und Gruppen.\n10. Wählen Sie Benutzer aus, auf die diese Richtlinie nicht angewendet werden soll, und klicken Sie auf Auswählen.\n11. Wählen Sie Cloud-Apps oder Aktionen.\n12. Wählen Sie Alle Cloud-Apps.\n13. Wählen Sie Gewähren.\n14. Unter Zugriff gewähren, markieren Sie Multi-Faktor-Authentifizierung erforderlich und klicken Sie auf Auswählen.\n15. Setzen Sie die Richtlinie auf Nur-Bericht.\n16. Klicken Sie auf Erstellen.\nNach dem Testen der Richtlinie im Nur-Bericht-Modus, ändern Sie die Einstellung Richtlinie aktivieren von Nur-Bericht auf Ein."
                }
            }
        },
        {
            "name": "mfa_policy_for_all_users",
            "title": "Ensure that a Multi-factor Authentication Policy Exists for All Users",
            "result_kinds": [],
            "categories": ["security", "compliance"],
            "risk": "Without a multi-factor authentication policy for all users, there is a higher risk of unauthorized access to accounts, which could lead to security breaches and unauthorized access to sensitive data.",
            "severity": "high",
            "detect": {
                "manual": "From Azure Portal:\n1. From Azure Home open the Portal Menu in the top left, and select Microsoft Entra ID.\n2. Scroll down in the menu on the left, and select Security.\n3. Select Conditional Access.\n4. Select the policy you wish to audit.\n5. View under Users and Groups the corresponding users and groups to whom the policy is applied.\n6. View under Exclude to determine which users and groups to whom the policy is not applied."
            },
            "remediation": {
                "text": "To create a multi-factor authentication policy for all users:\nFrom Azure Portal:\n1. From Azure Home open Portal menu in the top left, and select Microsoft Entra ID.\n2. Select Security.\n3. Select Conditional Access.\n4. Click + New policy.\n5. Enter a name for the policy.\n6. Select Users or workload identities.\n7. Under Include, select All users.\n8. Under Exclude, check Users and groups.\n9. Select users this policy should not apply to and click Select.\n10. Select Cloud apps or actions.\n11. Select All cloud apps.\n12. Select Grant.\n13. Under Grant access, check Require multifactor authentication and click Select.\n14. Set Enable policy to Report-only.\n15. Click Create.\nAfter testing the policy in report-only mode, update the Enable policy setting from Report-only to On.",
                "url": "https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-conditional-access-policy-all-users-mfa",
                "complexity": "medium"
            },
            "url": "https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-conditional-access-policy-all-users-mfa",
            "localizations": {
                "de": {
                    "title": "Stellen Sie sicher, dass eine Multi-Faktor-Authentifizierungsrichtlinie für alle Benutzer vorhanden ist",
                    "risk": "Ohne eine Multi-Faktor-Authentifizierungsrichtlinie für alle Benutzer besteht ein höheres Risiko eines unbefugten Zugriffs auf Konten, was zu Sicherheitsverletzungen und unbefugtem Zugriff auf sensible Daten führen könnte.",
                    "remediation": "Um eine Multi-Faktor-Authentifizierungsrichtlinie für alle Benutzer zu erstellen:\nVom Azure-Portal:\n1. Öffnen Sie das Portalmenü oben links im Azure-Startbildschirm und wählen Sie Microsoft Entra ID.\n2. Wählen Sie Sicherheit.\n3. Wählen Sie Bedingter Zugriff.\n4. Klicken Sie auf + Neue Richtlinie.\n5. Geben Sie einen Namen für die Richtlinie ein.\n6. Wählen Sie Benutzer oder Arbeitslast-Identitäten.\n7. Unter Einschließen, wählen Sie Alle Benutzer.\n8. Unter Ausschließen, markieren Sie Benutzer und Gruppen.\n9. Wählen Sie Benutzer aus, auf die diese Richtlinie nicht angewendet werden soll, und klicken Sie auf Auswählen.\n10. Wählen Sie Cloud-Apps oder Aktionen.\n11. Wählen Sie Alle Cloud-Apps.\n12. Wählen Sie Gewähren.\n13. Unter Zugriff gewähren, markieren Sie Multi-Faktor-Authentifizierung erforderlich und klicken Sie auf Auswählen.\n14. Setzen Sie die Richtlinie auf Nur-Bericht.\n15. Klicken Sie auf Erstellen.\nNach dem Testen der Richtlinie im Nur-Bericht-Modus, ändern Sie die Einstellung Richtlinie aktivieren von Nur-Bericht auf Ein."
                }
            }
        },
        {
            "name": "mfa_for_risky_signins",
            "title": "Ensure Multi-factor Authentication is Required for Risky Sign-ins",
            "result_kinds": [],
            "categories": ["security", "compliance"],
            "risk": "Without requiring multi-factor authentication for risky sign-ins, there is a higher risk of unauthorized access to accounts, which could lead to security breaches and unauthorized access to sensitive data.",
            "severity": "high",
            "detect": {
                "manual": "From Azure Portal:\n1. From Azure Home select the Portal Menu in the top left, and select Microsoft Entra ID.\n2. Select Security.\n3. Select Conditional Access.\n4. Select the policy you wish to audit.\n5. View under Users and Groups the corresponding users and groups to whom the policy is applied.\n6. View under Exclude to determine which users and groups to whom the policy is not applied."
            },
            "remediation": {
                "text": "To create a multi-factor authentication policy for risky sign-ins:\nFrom Azure Portal:\n1. From Azure Home select the Portal Menu in the top left, and select Microsoft Entra ID.\n2. Select Security.\n3. Select Conditional Access.\n4. Click + New policy.\n5. Enter a name for the policy.\n6. Select Users or workload identities.\n7. Under Include, select All users.\n8. Under Exclude, check Users and groups.\n9. Select users this policy should not apply to and click Select.\n10. Select Cloud apps or actions.\n11. Select All cloud apps.\n12. Select Conditions.\n13. Select Sign-in risk.\n14. Update the Configure toggle to Yes.\n15. Check the sign-in risk level this policy should apply to, e.g. High and Medium.\n16. Select Done.\n17. Click the blue text under Grant access and check Require multifactor authentication then click the Select button.\n18. Click the blue text under Session then check Sign-in frequency and select Every time and click the Select button.\n19. Set Enable policy to Report-only.\n20. Click Create.\nAfter testing the policy in report-only mode, update the Enable policy setting from Report-only to On.",
                "url": "https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-conditional-access-policy-risk",
                "complexity": "medium"
            },
            "url": "https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-conditional-access-policy-risk",
            "localizations": {
                "de": {
                    "title": "Stellen Sie sicher, dass Multi-Faktor-Authentifizierung für riskante Anmeldungen erforderlich ist",
                    "risk": "Ohne die Anforderung einer Multi-Faktor-Authentifizierung für riskante Anmeldungen besteht ein höheres Risiko eines unbefugten Zugriffs auf Konten, was zu Sicherheitsverletzungen und unbefugtem Zugriff auf sensible Daten führen könnte.",
                    "remediation": "Um eine Multi-Faktor-Authentifizierungsrichtlinie für riskante Anmeldungen zu erstellen:\nVom Azure-Portal:\n1. Wählen Sie im Azure-Startbildschirm das Portalmenü oben links aus und wählen Sie Microsoft Entra ID.\n2. Wählen Sie Sicherheit.\n3. Wählen Sie Bedingter Zugriff.\n4. Klicken Sie auf + Neue Richtlinie.\n5. Geben Sie einen Namen für die Richtlinie ein.\n6. Wählen Sie Benutzer oder Arbeitslast-Identitäten.\n7. Unter Einschließen, wählen Sie Alle Benutzer.\n8. Unter Ausschließen, markieren Sie Benutzer und Gruppen.\n9. Wählen Sie Benutzer aus, auf die diese Richtlinie nicht angewendet werden soll, und klicken Sie auf Auswählen.\n10. Wählen Sie Cloud-Apps oder Aktionen.\n11. Wählen Sie Alle Cloud-Apps.\n12. Wählen Sie Bedingungen.\n13. Wählen Sie Anmelderisiko.\n14. Aktualisieren Sie den Konfiguration-Schalter auf Ja.\n15. Markieren Sie das Anmelderisiko-Level, auf das diese Richtlinie angewendet werden soll, z.B. Hoch und Mittel.\n16. Wählen Sie Fertig.\n17. Klicken Sie auf den blauen Text unter Zugriff gewähren und markieren Sie Multi-Faktor-Authentifizierung erforderlich, dann klicken Sie auf die Schaltfläche Auswählen.\n18. Klicken Sie auf den blauen Text unter Sitzung und markieren Sie Anmeldefrequenz und wählen Sie Jedes Mal und klicken Sie auf die Schaltfläche Auswählen.\n19. Setzen Sie die Richtlinie auf Nur-Bericht.\n20. Klicken Sie auf Erstellen.\nNach dem Testen der Richtlinie im Nur-Bericht-Modus, ändern Sie die Einstellung Richtlinie aktivieren von Nur-Bericht auf Ein."
                }
            }
        },
        {
            "name": "mfa_for_azure_service_management_api",
            "title": "Ensure Multi-factor Authentication is Required for Windows Azure Service Management API",
            "result_kinds": [],
            "categories": ["security", "compliance"],
            "risk": "Without requiring multi-factor authentication for accessing the Windows Azure Service Management API, there is a higher risk of unauthorized administrative actions, which could lead to security breaches and unauthorized changes to administrative settings.",
            "severity": "high",
            "detect": {
                "manual": "From Azure Portal:\n1. From the Azure Admin Portal dashboard, open Microsoft Entra ID.\n2. In the menu on the left of the Entra ID blade, click Security.\n3. In the menu on the left of the Security blade, click Conditional Access.\n4. In the menu on the left of the Conditional Access blade, click Policies.\n5. Click on the name of the policy you wish to audit.\n6. Click the blue text under Users.\n7. Under the Include section of Users, review Users and Groups to ensure that All Users is selected.\n8. Under the Exclude section of Users, review the Users and Groups that are excluded from the policy (NOTE: this should be limited to break-glass emergency access accounts, non-interactive service accounts, and other carefully considered exceptions).\n9. On the left side, click the blue text under Target Resources.\n10. Select what this policy applies to should have Cloud apps selected.\n11. Under the Include section of Target Resources, the Select apps radio button should be selected.\n12. Click the blue text under Select.\n13. From the select prompt that appears, the checkbox for Windows Azure Service Management API should be checked."
            },
            "remediation": {
                "text": "To create a multi-factor authentication policy for the Windows Azure Service Management API:\nFrom Azure Portal:\n1. From the Azure Admin Portal dashboard, open Microsoft Entra ID.\n2. Click Security in the Entra ID blade.\n3. Click Conditional Access in the Security blade.\n4. Click Policies in the Conditional Access blade.\n5. Click + New policy.\n6. Enter a name for the policy.\n7. Click the blue text under Users.\n8. Under Include, select All users.\n9. Under Exclude, check Users and groups.\n10. Select users or groups to be exempted from this policy (e.g. break-glass emergency accounts, and non-interactive service accounts) then click the Select button.\n11. Click the blue text under Target Resources.\n12. Under Include, click the Select apps radio button.\n13. Click the blue text under Select.\n14. Check the box next to Windows Azure Service Management APIs then click the Select button.\n15. Click the blue text under Grant.\n16. Under Grant access check the box for Require multifactor authentication then click the Select button.\n17. Before creating, set Enable policy to Report-only.\n18. Click Create.\nAfter testing the policy in report-only mode, update the Enable policy setting from Report-only to On.",
                "url": "https://learn.microsoft.com/en-us/entra/identity/conditional-access/howto-conditional-access-policy-azure-management",
                "complexity": "medium"
            },
            "url": "https://learn.microsoft.com/en-us/entra/identity/conditional-access/howto-conditional-access-policy-azure-management",
            "localizations": {
                "de": {
                    "title": "Stellen Sie sicher, dass Multi-Faktor-Authentifizierung für Windows Azure Service Management API erforderlich ist",
                    "risk": "Ohne die Anforderung einer Multi-Faktor-Authentifizierung für den Zugriff auf die Windows Azure Service Management API besteht ein höheres Risiko unbefugter administrativer Aktionen, was zu Sicherheitsverletzungen und unbefugten Änderungen an administrativen Einstellungen führen könnte.",
                    "remediation": "Um eine Multi-Faktor-Authentifizierungsrichtlinie für die Windows Azure Service Management API zu erstellen:\nVom Azure-Portal:\n1. Öffnen Sie das Azure Admin Portal-Dashboard und wählen Sie Microsoft Entra ID.\n2. Klicken Sie im Entra ID-Blade auf Sicherheit.\n3. Klicken Sie im Sicherheits-Blade auf Bedingter Zugriff.\n4. Klicken Sie im Bedingter Zugriff-Blade auf Richtlinien.\n5. Klicken Sie auf + Neue Richtlinie.\n6. Geben Sie einen Namen für die Richtlinie ein.\n7. Klicken Sie auf den blauen Text unter Benutzer.\n8. Unter Einschließen, wählen Sie Alle Benutzer.\n9. Unter Ausschließen, markieren Sie Benutzer und Gruppen.\n10. Wählen Sie Benutzer oder Gruppen, die von dieser Richtlinie ausgenommen werden sollen (z.B. Notfallzugangskonten und nicht interaktive Dienstkonten) und klicken Sie dann auf die Schaltfläche Auswählen.\n11. Klicken Sie auf den blauen Text unter Zielressourcen.\n12. Unter Einschließen, klicken Sie auf das Radio-Button 'Apps auswählen'.\n13. Klicken Sie auf den blauen Text unter Auswählen.\n14. Markieren Sie das Kontrollkästchen neben Windows Azure Service Management APIs und klicken Sie dann auf die Schaltfläche Auswählen.\n15. Klicken Sie auf den blauen Text unter Gewähren.\n16. Unter Zugriff gewähren markieren Sie das Kontrollkästchen für Multi-Faktor-Authentifizierung erforderlich und klicken Sie dann auf die Schaltfläche Auswählen.\n17. Bevor Sie die Richtlinie erstellen, setzen Sie die Einstellung Richtlinie aktivieren auf Nur-Bericht.\n18. Klicken Sie auf Erstellen.\nNach dem Testen der Richtlinie im Nur-Bericht-Modus, ändern Sie die Einstellung Richtlinie aktivieren von Nur-Bericht auf Ein."
                }
            }
        },
        {
            "name": "mfa_for_microsoft_admin_portals",
            "title": "Ensure Multi-factor Authentication is Required to Access Microsoft Admin Portals",
            "result_kinds": [],
            "categories": ["security", "compliance"],
            "risk": "Without requiring multi-factor authentication for accessing Microsoft Admin Portals, there is a higher risk of unauthorized administrative actions, which could lead to security breaches and unauthorized changes to administrative settings.",
            "severity": "high",
            "detect": {
                "manual": "From Azure Portal:\n1. From the Azure Admin Portal dashboard, open Microsoft Entra ID.\n2. In the menu on the left of the Entra ID blade, click Security.\n3. In the menu on the left of the Security blade, click Conditional Access.\n4. In the menu on the left of the Conditional Access blade, click Policies.\n5. Click on the name of the policy you wish to audit.\n6. Click the blue text under Users.\n7. Under the Include section of Users, review Users and Groups to ensure that All Users is selected.\n8. Under the Exclude section of Users, review the Users and Groups that are excluded from the policy (NOTE: this should be limited to break-glass emergency access accounts, non-interactive service accounts, and other carefully considered exceptions).\n9. On the left side, click the blue text under Target Resources.\n10. Select what this policy applies to should have Cloud apps selected.\n11. Under the Include section of Target Resources, the Select apps radio button should be selected.\n12. Click the blue text under Select.\n13. From the select prompt that appears, the checkbox for Microsoft Admin Portals should be checked."
            },
            "remediation": {
                "text": "To create a multi-factor authentication policy for Microsoft Admin Portals:\nFrom Azure Portal:\n1. From the Azure Admin Portal dashboard, open Microsoft Entra ID.\n2. Click Security in the Entra ID blade.\n3. Click Conditional Access in the Security blade.\n4. Click Policies in the Conditional Access blade.\n5. Click + New policy.\n6. Enter a name for the policy.\n7. Click the blue text under Users.\n8. Under Include, select All users.\n9. Under Exclude, check Users and groups.\n10. Select users or groups to be exempted from this policy (e.g. break-glass emergency accounts, and non-interactive service accounts) then click the Select button.\n11. Click the blue text under Target Resources.\n12. Under Include, click the Select apps radio button.\n13. Click the blue text under Select.\n14. Check the box next to Microsoft Admin Portals then click the Select button.\n15. Click the blue text under Grant.\n16. Under Grant access check the box for Require multifactor authentication then click the Select button.\n17. Before creating, set Enable policy to Report-only.\n18. Click Create.\nAfter testing the policy in report-only mode, update the Enable policy setting from Report-only to On.",
                "url": "https://learn.microsoft.com/en-us/entra/identity/conditional-access/how-to-policy-mfa-admin-portals",
                "complexity": "medium"
            },
            "url": "https://learn.microsoft.com/en-us/entra/identity/conditional-access/how-to-policy-mfa-admin-portals",
            "localizations": {
                "de": {
                    "title": "Stellen Sie sicher, dass Multi-Faktor-Authentifizierung für den Zugriff auf Microsoft Admin Portale erforderlich ist",
                    "risk": "Ohne die Anforderung einer Multi-Faktor-Authentifizierung für den Zugriff auf Microsoft Admin Portale besteht ein höheres Risiko unbefugter administrativer Aktionen, was zu Sicherheitsverletzungen und unbefugten Änderungen an administrativen Einstellungen führen könnte.",
                    "remediation": "Um eine Multi-Faktor-Authentifizierungsrichtlinie für Microsoft Admin Portale zu erstellen:\nVom Azure-Portal:\n1. Öffnen Sie das Azure Admin Portal-Dashboard und wählen Sie Microsoft Entra ID.\n2. Klicken Sie im Entra ID-Blade auf Sicherheit.\n3. Klicken Sie im Sicherheits-Blade auf Bedingter Zugriff.\n4. Klicken Sie im Bedingter Zugriff-Blade auf Richtlinien.\n5. Klicken Sie auf + Neue Richtlinie.\n6. Geben Sie einen Namen für die Richtlinie ein.\n7. Klicken Sie auf den blauen Text unter Benutzer.\n8. Unter Einschließen, wählen Sie Alle Benutzer.\n9. Unter Ausschließen, markieren Sie Benutzer und Gruppen.\n10. Wählen Sie Benutzer oder Gruppen, die von dieser Richtlinie ausgenommen werden sollen (z.B. Notfallzugangskonten und nicht interaktive Dienstkonten) und klicken Sie dann auf die Schaltfläche Auswählen.\n11. Klicken Sie auf den blauen Text unter Zielressourcen.\n12. Unter Einschließen, klicken Sie auf das Radio-Button 'Apps auswählen'.\n13. Klicken Sie auf den blauen Text unter Auswählen.\n14. Markieren Sie das Kontrollkästchen neben Microsoft Admin Portale und klicken Sie dann auf die Schaltfläche Auswählen.\n15. Klicken Sie auf den blauen Text unter Gewähren.\n16. Unter Zugriff gewähren markieren Sie das Kontrollkästchen für Multi-Faktor-Authentifizierung erforderlich und klicken Sie dann auf die Schaltfläche Auswählen.\n17. Bevor Sie die Richtlinie erstellen, setzen Sie die Einstellung Richtlinie aktivieren auf Nur-Bericht.\n18. Klicken Sie auf Erstellen.\nNach dem Testen der Richtlinie im Nur-Bericht-Modus, ändern Sie die Einstellung Richtlinie aktivieren von Nur-Bericht auf Ein."
                }
            }
        }
    ]
}
